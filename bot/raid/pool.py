class Pool(object):
    def __init__(self):
        self.group = []
        self.q = []
        self.mb = []
        self.used_mb = []
        self.join_history = []
        self.kicked = []
        self.group_miss = []

    def size(self):
        return len(self.mb) + len(self.q) + len(self.group)

    def remove(self, uid):
        if uid not in self.join_history:
            return False

        removed = False
        if uid in self.mb:
            self.mb.remove(uid)
            removed = True

        try:
            self.q.remove(uid)
            removed = True
        except ValueError:
            pass

        return removed

    def get_next(self, n=1, advance=False):
        out = [{**x, 'attempts': x['attempts'] + 1} for x in self.group if x['uid'] in self.group_miss]

        mb_out = self.mb[:n - len(out)]
        out.extend({'uid': uid, 'join_type': 'mb', 'attempts': 0} for uid in mb_out)

        if advance:
            self.mb = self.mb[len(mb_out):]

        if len(out) < n:
            pb_out = self.q[:n - len(out)]
            out.extend({'uid': uid, 'join_type': 'pb', 'attempts': 0} for uid in pb_out)

            if advance:
                self.q[:] = self.q[len(pb_out):]

        if advance:
            self.group_miss.clear()

        return out

    def add_miss(self, uid):
        self.group_miss.append(uid)




# 213136927128289280, 213136927128289280, 660980949231599646, 213136927128289280, 252565363290669057, 314096161453506560, 314096161453506560, 252565363290669057, 252565363290669057, 370633705091497985, 180708630054567936, 381445812494008321, 381445812494008321, 180708630054567936, 180708630054567936, 381445812494008321, 180708630054567936, 180708630054567936, 381445812494008321, 180708630054567936, 180708630054567936, 381445812494008321, 180708630054567936, 180708630054567936, 381445812494008321, 180708630054567936, 381445812494008321, 180708630054567936, 381445812494008321, 180708630054567936, 180708630054567936, 381445812494008321, 180708630054567936, 381445812494008321, 180708630054567936, 180708630054567936, 180708630054567936, 381445812494008321, 180708630054567936, 381445812494008321, 180708630054567936, 180708630054567936, 381445812494008321, 381445812494008321, 381445812494008321, 180708630054567936, 381445812494008321, 180708630054567936, 381445812494008321, 381445812494008321, 180708630054567936, 180708630054567936, 180708630054567936, 381445812494008321, 673257997191086080, 247386293741289473, 247386293741289473, 673257997191086080, 673257997191086080, 518196879813509121, 673257997191086080, 673257997191086080, 673257997191086080, 341669361519689730, 518196879813509121, 673257997191086080, 673257997191086080, 518196879813509121, 673257997191086080, 673257997191086080, 518196879813509121, 673257997191086080, 673257997191086080, 518196879813509121, 673257997191086080, 673257997191086080, 518196879813509121, 673257997191086080, 138629784220598272, 138629784220598272, 518196879813509121, 518196879813509121, 370633705091497985, 518196879813509121, 341669361519689730, 518196879813509121, 518196879813509121, 518196879813509121, 180708630054567936, 180708630054567936, 518196879813509121, 518196879813509121, 314548244963131395, 314548244963131395, 232650437617123328, 88109920204881920, 341669361519689730, 221818486329049088, 357179587073146893, 212394291060932608, 357179587073146893, 357179587073146893, 357179587073146893, 212394291060932608, 357179587073146893, 212394291060932608, 357179587073146893, 212394291060932608, 221818486329049088, 357179587073146893, 212394291060932608, 213136927128289280, 178652983721066496, 213136927128289280, 221818486329049088, 213136927128289280, 213136927128289280, 178652983721066496, 178652983721066496, 357179587073146893, 213136927128289280, 221818486329049088, 178652983721066496, 178652983721066496, 178652983721066496, 213136927128289280, 221818486329049088, 221818486329049088, 221818486329049088, 357179587073146893, 212394291060932608, 213136927128289280, 221818486329049088, 212394291060932608, 212394291060932608, 221818486329049088, 221818486329049088, 213136927128289280, 178652983721066496, 221818486329049088, 213136927128289280, 178652983721066496, 212394291060932608, 212394291060932608, 213136927128289280, 178652983721066496, 221818486329049088, 221818486329049088, 221818486329049088, 212394291060932608, 213136927128289280, 178652983721066496, 178652983721066496, 178652983721066496, 213136927128289280, 213136927128289280, 357179587073146893, 213136927128289280, 212394291060932608, 178652983721066496, 178652983721066496, 357179587073146893, 178652983721066496, 221818486329049088, 221818486329049088, 221818486329049088, 213136927128289280, 357179587073146893, 178652983721066496, 213136927128289280, 213136927128289280, 178652983721066496, 221818486329049088, 357179587073146893, 178652983721066496, 178652983721066496, 178652983721066496, 178652983721066496, 221818486329049088, 212394291060932608, 221818486329049088, 221818486329049088, 213136927128289280, 221818486329049088, 221818486329049088, 212394291060932608, 213136927128289280, 212394291060932608, 178652983721066496, 178652983721066496, 357179587073146893, 178652983721066496, 213136927128289280, 213136927128289280, 213136927128289280, 212394291060932608, 213136927128289280, 213136927128289280, 213136927128289280, 357179587073146893
